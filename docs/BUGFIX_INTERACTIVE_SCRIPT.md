# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Interactive Demo Script

**–î–∞—Ç–∞:** 2025-10-17  
**–ü—Ä–æ–±–ª–µ–º–∞:** Health checks –≤ `interactive_demo.sh` –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ "connection error"  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã:
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `./scripts/interactive_demo.sh` –æ–ø—Ü–∏—è "1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞:
```
frontend-service: ‚ùå connection error
orchestrator-agent: ‚ùå connection error
...
```

–ü—Ä–∏ —ç—Ç–æ–º curl –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é —Ä–∞–±–æ—Ç–∞–ª–∏ –æ—Ç–ª–∏—á–Ω–æ:
```bash
TOKEN=$(gcloud auth print-identity-token)
curl -H "Authorization: Bearer $TOKEN" https://frontend-service-38390150695.us-central1.run.app/health
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"status":"healthy"}
```

### –ü—Ä–∏—á–∏–Ω—ã:

1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –≤ subshell**
   ```bash
   # –°—Ç–∞—Ä—ã–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 67):
   response=$(curl -s -m 10 -H "Authorization: Bearer $TOKEN" "$url/health" 2>/dev/null || echo "error")
   ```
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `$TOKEN` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ
   - –í subshell `$()` —Ç–æ–∫–µ–Ω –º–æ–≥ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º
   - –¢–æ–∫–µ–Ω –º–æ–≥ –∏—Å—Ç–µ–∫–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –¥–æ–ª–≥–æ–π —Å–µ—Å—Å–∏–∏

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞**
   - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–ª —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ —Å–ª–æ–≤–∞ "healthy" –≤ –æ—Ç–≤–µ—Ç–µ
   - –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª HTTP –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ (200, 401, 403, 500 –∏ —Ç.–¥.)
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏

3. **–°–ª–∞–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
   - –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–µ–≥–æ —Ç–æ–∫–µ–Ω–∞

```bash
# –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
get_token() {
    gcloud auth print-identity-token 2>/dev/null
}
```

–¢–µ–ø–µ—Ä—å —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º.

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è

```bash
check_service_health() {
    local name=$1
    local url=$2
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    local token=$(get_token)
    
    echo -n "  $name: "
    
    # –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∏ HTTP –∫–æ–¥, –∏ –æ—Ç–≤–µ—Ç
    local temp_file=$(mktemp)
    local http_code=$(curl -s -w "%{http_code}" -m 10 \
        -H "Authorization: Bearer $token" \
        -o "$temp_file" \
        "$url/health" 2>/dev/null)
    
    local response=$(cat "$temp_file")
    rm -f "$temp_file"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP –∫–æ–¥
    if [ "$http_code" = "200" ]; then
        if echo "$response" | grep -q "healthy"; then
            echo -e "${GREEN}‚úÖ healthy${NC} (HTTP $http_code)"
        else
            echo -e "${YELLOW}‚ö†Ô∏è  responded but status unclear${NC} (HTTP $http_code)"
        fi
    elif [ -z "$http_code" ]; then
        echo -e "${RED}‚ùå connection error${NC} (timeout or network issue)"
    else
        echo -e "${RED}‚ùå unhealthy${NC} (HTTP $http_code)"
    fi
}
```

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –°–≤–µ–∂–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é `-w "%{http_code}"`
- –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞
- –î–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º HTTP –∫–æ–¥–∞
- –†–∞–∑–ª–∏—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ HTTP –æ—à–∏–±–æ–∫

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

–í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ —Ç.–¥.) –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:

```bash
# –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
TOKEN=$(get_token)
curl -H "Authorization: Bearer $TOKEN" ...
```

### 4. Verbose —Ä–µ–∂–∏–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –æ–ø—Ü–∏—è "v" –≤ –º–µ–Ω—é:

```bash
v|V)
    if [ -z "$VERBOSE" ]; then
        export VERBOSE=1
        echo -e "${GREEN}‚úÖ Verbose —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω${NC}"
    else
        unset VERBOSE
        echo -e "${YELLOW}‚ö†Ô∏è  Verbose —Ä–µ–∂–∏–º –≤—ã–∫–ª—é—á–µ–Ω${NC}"
    fi
    ;;
```

–í verbose —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

## üÜï –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: test_health.sh

–°–æ–∑–¥–∞–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è:

```bash
./scripts/test_health.sh         # –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
./scripts/test_health.sh -v      # verbose —Ä–µ–∂–∏–º
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 5 —Å–µ—Ä–≤–∏—Å–æ–≤
- Exit code 0 –µ—Å–ª–∏ –≤—Å–µ healthy, 1 –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CI/CD
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ verbose —Ä–µ–∂–∏–º–∞

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤...

  frontend-service: ‚ùå connection error
  orchestrator-agent: ‚ùå connection error
  report-reader-agent: ‚ùå connection error
  logic-understanding-agent: ‚ùå connection error
  visualization-agent: ‚ùå connection error
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤...

  frontend-service: ‚úÖ healthy (HTTP 200)
  orchestrator-agent: ‚úÖ healthy (HTTP 200)
  report-reader-agent: ‚úÖ healthy (HTTP 200)
  logic-understanding-agent: ‚úÖ healthy (HTTP 200)
  visualization-agent: ‚úÖ healthy (HTTP 200)
```

## üéØ –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –§–∞–π–ª—ã:

1. **scripts/interactive_demo.sh** ‚úèÔ∏è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_token()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_service_health()`
   - –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º API –∑–∞–ø—Ä–æ—Å–æ–º
   - –î–æ–±–∞–≤–ª–µ–Ω verbose —Ä–µ–∂–∏–º
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **scripts/test_health.sh** üÜï
   - –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CI/CD

3. **docs/BUGFIX_INTERACTIVE_SCRIPT.md** üìù
   - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

## üí° –£—Ä–æ–∫–∏

### –ß—Ç–æ —É–∑–Ω–∞–ª–∏:

1. **Bash subshells –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `$()` –º–æ–≥—É—Ç –Ω–µ –≤–∏–¥–µ—Ç—å export –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ shell
   - –õ—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

2. **GCP Identity Tokens**
   - –¢–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –∏—Å—Ç–µ–∫–∞—Ç—å
   - –î–ª—è –¥–æ–ª–≥–∏—Ö interactive —Å–µ—Å—Å–∏–π –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω
   - `gcloud auth print-identity-token` –±—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (~0.1s)

3. **–û—Ç–ª–∞–¥–∫–∞ bash —Å–∫—Ä–∏–ø—Ç–æ–≤**
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞
   - –î–æ–±–∞–≤–ª—è–π—Ç–µ verbose —Ä–µ–∂–∏–º—ã –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

4. **curl best practices**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-w "%{http_code}"` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-o` –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ timeouts –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç HTTP –æ—à–∏–±–æ–∫

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

### –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
cd /Users/sergejbykov/financial-reports-system

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
./scripts/interactive_demo.sh

# –ò–ª–∏ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
./scripts/test_health.sh
```

### –° verbose –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å interactive demo
./scripts/interactive_demo.sh

# –í –º–µ–Ω—é –≤—ã–±—Ä–∞—Ç—å: v (–≤–∫–ª—é—á–∏—Ç—å verbose)
# –ó–∞—Ç–µ–º –≤—ã–±—Ä–∞—Ç—å: 1 (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ)

# –ò–ª–∏ —Å test_health.sh
./scripts/test_health.sh -v
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

- [x] –°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [x] Health checks –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "healthy" –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [x] Verbose —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] test_health.sh —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `scripts/interactive_demo.sh` - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- `scripts/test_health.sh` - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `STATUS.md` - –æ–±–Ω–æ–≤–ª—ë–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `USER_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìù –ö–æ–º–º–∏—Ç—ã

1. `05ae514` - Fix: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω health check –≤ interactive_demo.sh
2. `73f1705` - Add: –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤
3. (—Ç–µ–∫—É—â–∏–π) - Docs: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è interactive script

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.** ‚úÖ
